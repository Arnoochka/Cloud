# Проектная работа по дисциплине: "Основы распределенных вычислений"
## Идея: создание децентрализованного облачного хранилища
Система разделена на 4 типа серверов: Input, Database, Controller, Data Storage (DS). Общая схема работы:
![general sheme of work](https://github.com/ARnoD0rian/Cloud/blob/main/images/general%20sheme%20of%20work.png)
### Input
Данный тип серверов предназначен для общения с клиентом и отправки необходимых запросов на остальные типы сервером. В системе 2 сервера такого типа, хотя однако быть любое количество, так как они независимы.
### Database
Данных тип серверов хранит данные об авторизованных пользователях. В системе их 3. В зависимости от состояния системы, каждый сервер может принимать одну из ролей (main, helper). Изначально в системе 1  main и 2 helper серверов. от Input сервера могут приходить 2 вида запросов: запрос на регистрацию и запрос на авторизацию.
При получении запроса на регистрацию main сервер проверяет в своей базе, является ли пользователь зарегистрированным. Затем обращается к одному из helper для проверки, существует ли пользователь в его базе данных. Если получает отрицательный ответ, то main сервер сохраняет к себе в базу данные о пользователе и в базу сервера helper, к которому он отправлял запрос.
При получении запроса на авторизацию, main сервер также проверяет данные о пользователе в 2-х базах. Если хотя бы в 1 из базах пользователь с такими данными существует, то он может быть авторизованным.
### Controller
Роль данного типа серверов состоит в том, чтобы контролировать работу Data Storage. В системе всего имеется 3 сервера данного типа. 
### Data Storage
Данный тип серверов хранит файлы пользователей. В системе 6 серверов такого типа
### Команды, выполняемые системой
Всего имеется 4 типа команд, доступные пользователям. 1) Сохранение файла в облако 2) получение файла пользователем 3) Удаление файла из облака 4) Авторизация и регистрация аккаунта. Последняя описана ранее. Рассмотрим принцип работы первых 3-х команд. При их рассмотрении считается, что пользователь уже авторизован в системе
1) Сохранение файла в облако
Пользователь отправляет запрос на Input => Controller. Controller проверяет, если уже файл с таким именем у данного пользователя в облаке. Для этого он проверяет записи у себя  и в базе у одного из 
 серверов типа controller.Если файла с таким именем не найдено, то controller проверяет, какие DS сейчас работают и, в зависимости от их загруженности выбирает 3. Выбирает из них 1 и отправляет его адрес Input => CLient. Хранилищу, чем адрес отправлен клиенту, посылает адреса двух DS. После получения, хранилище готово принимать данные от пользователя. Пользователь в это время начинает отправлять файлы по полученному адресу. При получении файлов, DS сохраняет их у себя и параллельно отправляет двум хранилищам, которые также сохраняют их у себя. После сохранения на трех хранилищах, Controller получает уведомление о том, что файл сохранен и сохраняет данные а файле у себя, а также еще у одного сервера типа controller. Общая схема работы:
![save](https://github.com/ARnoD0rian/Cloud/blob/main/images/get.png)
2) Получение файлов
Пользователь отправляет запрос на Input => Controller. Controller   проверяет свою базу данных и еще одного контроллера, если данные о файле найдены, то находится работающая DS на которой файл сохранен и ее адрес отправялестя пользователю. Пользователь отправляет запрос на пролучение файла на DS. Схема работы:
![get](https://github.com/ARnoD0rian/Cloud/blob/main/images/save.png)
3) Удаление файла
Пользователь отправляет запрос на Input => Controller. Если в своей базе данных есть информация о файле, то он отправляет запросы на удаление на DS  и на другие сервера типа controller. Если в своей базе нет, то посылает запрос на поис файлов на другие controller

 

